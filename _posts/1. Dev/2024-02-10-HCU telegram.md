---
title: "HCU telegram 1편"
excerpt: "기본적인 사전 작업에 관한 이야기"

categories:
  - Dev
  - HCU telegrambot
tags:
  - [Python, 1인 개발]

permalink: /categories1/HCU telegram/

toc: true
toc_sticky: true

date: 2024-02-10
last_modified_at: 2024-02-10
---

# HCU telegrambot

 꽤 오랜만에 블로그에 글을 쓴다. 사실 귀찮았던 것도 있지만, 고등학교 졸업 이후에 여기저기 놀러 다니고 게임을 하느라 프로그래밍 공부 자체를 느슨하게 한 것이 가장 크다...

어찌 되었건 이제 이틀 뒤면 대학교 입학이고, 때마침 전산동아리 WING이 모집 공고를 올렸기에 이를 계기로 HCU telegrambot의 개발 스토리를 조금 정리해보자고 한다. 사실 실질적인 개발 기간은 약 1년 정도밖에 걸리지 않았지만, 그 과정을 이해하고 공부해 나가는 데에는 3년이라는 고등학교 생활 전체에 달하는 시간이 들었다.

SQL을 제외한다면 오로지 Python만으로 만들어진 해당 프로젝트는 사실 다른 언어와 함께 사용(예를 들어 서버와 통신하는 쪽)했으면 훨씬 가볍고 빠를 수 있었겠지만, 그럼에도 개인적으로는 성공했다고 생각하는 프로젝트이며 꽤나 의미 있는 교훈을 많이 얻었다.

## 청운 네트워크

청운고는 생각보다 많은 학교 내의 행정적인 업무가 청운네트워크로 처리되고 있었으며, 1학년 갓 입학한 나에게는 청운네트워크는 재미있는 놀이터였다. 입학 1주일 만에 청운 네트워크를 해킹해 내면서 친구들의 청운네트워크 계정을 탈취할 수 있었고, 얼마 안 가서 특정 선생님들의 계정 또한 해킹했다. 확실히 지금 생각하면 정말 미친 짓이지만, 당시에는 정말 아무렇지도 않게 일을 벌인 것 같다. 덕분에 얼마 안가 선생님들의 블랙리스트에 들었고, 청운네트워크를 해킹해서 악용하지 않으리라 다짐하였다. 이후 혼자서 여러 프로젝트를 진행하면서 보안이 얼마나 힘든 분야인지도 깨닫게 되었고, 말에는 청운 네트워크의 보안 취약점을 분석하여 선생님들께 보고서도 제출했다. 하지만 이건 다른 이야기고 원래 이야기로 돌아와서, 나는 청운네트워크를 해킹하고 뜯어보면서 청운네트워크의 동작 방식에 관해 꽤 많은 것을 배우게 되었다. 그리고 이를 이해하기 위해 계속해서 공부를 거듭한 결과, 웹이 어떻게 동작하는지, 그리고 서버와 어떻게 통신하는지, 이를 크롤링을 통해서 어떻게 메크로로 만들 수 있는지를 부수적으로 배우게 됐다. 사실 웹은 딱히 내가 크게 관심을 가지는 분야가 아니었기에, 각각에 관해 깊게 공부하지는 않았지만 그래도 나름 어떻게 하면 직접 사이트에 접속하지 않고 서버와 통신하며 정보를 주고받을 수 있는지 정도는 아는 수준에 다다랐다. 

## 급식 단축어

HCU telegrambot과 급식 단축어가 무슨 상관이냐고 하는 사람들도 있겠느냐마는, 사실 급식 단축어를 통해 크롤링의 기본적인 원리를 배웠다고 해도 과언이 아니다. 웹사이트의 구조를 파악하여 원하는 정보를 어떻게 가져오는지, 그리고 정규표현식을 이용하여 원하는 페턴의 정보를 가져오는 일은 사실 전혀 어려운 것은 아니었다. 그래도 급식 단축어가 성공하면서 나에게 HCU telegrambot을 개발할 아이디어가 떠올랐고, 1학년 2학기 때부터 HCU telegrambot을 계획하게 되었다. 

## 로그인, 그리고 고난

사실 HCU telegrambot을 만들면서 무엇이 가장 힘들었냐고 묻는다면 나는 로그인 문제 해결과 보안 문제라고 답할 것이다. 보안 문제는 말 그대로 어떻게 하면 해당 프로젝트의 보안성을 향상할 수 있을까의 문제였고, 로그인 문제는 어떻게 하면 telegram과 청운네트워크를 직접적으로 연동하고, 이를 통해서 청운네트워크에 로그인하냐는 문제였다. 이거 알아내는 데만 1년 걸렸다(사실 도중부터는 거의 포기해서 1년이지 실은 한 3달 걸렸다). 기존에 Python을 통해서 사이트에 로그인하는 방법은 쿠키를 이용해서 사이트에 접속하는 방법이었는데, 이는 서버가 동시에 여러 계정을 관리하게 되면 쿠키끼리 겹쳐서 A의 계정과 B의 계정 정보가 뒤죽박죽되는 문제가 일어났다. 그래서 하는 수 없이 post에 관해 공부하며 python의 `requests` 라이브러리를 이용해 사이트에 로그인하였다. 아래는 내가 실제로 사용한 코드이다.

```python
with requests.Session() as s:
  data = {
      'sel': 'stu',
      'text1': student_num,
      'password': pw,
  }
  s.post('https://hcuhs.kr/login_check.php', headers=headers, data=data)
  response = s.get(url=url, headers=headers)
  response.encoding = 'EUC-KR'
  if response.status_code == 200:
      if '접속이 끊어졌습니다' not in response.text:
          return response.text
```

참고로 `headers`는 그냥 아무거나 사용해도 되며,`url`은 로그인 이후 접속하고 싶은 페이지를 입력하면 된다. 예를 들면 급식신청 페이지라면, "https://hcuhs.kr/meal/student.php"을 url로 넣으면 된다. 이렇게 오랜 숙원 중 하나였던 "청운네트워크에 로그인해 정보 가져오기"를 해결하였다.

## SQL 서버

청운네트워크에 로그인해서 정보를 가져오는 데에는 성공하였지만, 많은 계정을 저장해서 관리하는 것은 또 다른 문제였다. 이를 해결하기 위해 SQL 서버를 도입하기로 하였고, 서버와 백엔드에 관해 공부하기 시작했다. 기본적인 SQL 서버의 구조는 telegram이 가지는 유저의 개인 고유 id를 key값으로 하였으며, 유저의 학번과 자동 급식 신청 여부(후에 더 자세하게 다루겠다) 등 여러 정보를 저장하는 데 유용하게 사용되었다. 그리고 HCU telegrambot은 Python을 백엔드로 사용하기에 `pymysql`을 통해 SQL 서버와 통신하게 했다. 

---

로그인 이후 HCU telegramnbot이 작동하는 원리는 속편에서 더욱 자세하게 설명하겠다. 